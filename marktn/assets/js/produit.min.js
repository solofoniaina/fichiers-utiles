 
 function readURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
            $('#new-image').attr('src', e.target.result);
        };
        reader.readAsDataURL(input.files[0]);
         $('#enreg_photo').css('display','inline-block');  
    }
}

/*UPLOAD*/

//configuration
var max_file_size           = 500000000; //allowed file size. (1 MB = 1048576)
var allowed_file_types      = ['image/png', 'image/gif', 'image/jpeg', 'image/pjpeg', 'video/avi', 'video/mp4']; //allowed file types
var result_output           = '#load_image'; //ID of an element for response output
var my_form_id              = '#upload_produit_package'; //ID of an element for response output
var progress_bar_id         = '#progress-wrp'; //ID of an element for response output
var total_files_allowed     = 3; //Number files allowed to upload



//on form submit
$(my_form_id).on( "submit", function(event) { 
    event.preventDefault();
    var proceed = true; //set proceed flag
    var error = []; //errors
    var total_files_size = 0;
    
    //reset progressbar
    $(progress_bar_id +" .progress-bar").css("width", "0%");
    $(progress_bar_id + " .status").text("0%");
                            
    if(!window.File && window.FileReader && window.FileList && window.Blob){ //if browser doesn't supports File API
        error.push("Votre navigateur ne supporte pas le téléchargement de fichier."); //push error text
    }else{
         /*
        var total_selected_files = this.elements['lien_p'].files.length; //number of files
        
       
        //limit number of files allowed
        if(total_selected_files > total_files_allowed){
            error.push( "Vous avez selectionné "+total_selected_files+" fichier(s), " + total_files_allowed +" est le maximum!"); //push error text
            proceed = false; //set proceed flag to false
        }
         //iterate files in file input field
        $(this.elements['lien_p'].files).each(function(i, ifile){
            if(ifile.value !== ""){ //continue only if file(s) are selected
                if(allowed_file_types.indexOf(ifile.type) === -1){ //check unsupported file
                    error.push( "le type de fichier <b>"+ ifile.name + "</b> est non supporté!"); //push error text
                    proceed = false; //set proceed flag to false
                }

                total_files_size = total_files_size + ifile.size; //add file size to total size
            }
        });

        
        //if total file size is greater than max file size
        if(total_files_size > max_file_size){ 
            error.push( "Vous avez "+total_selected_files+" fichiers avec "+total_files_size+" au total, la taille max est " + max_file_size +"!"); //push error text
            proceed = false; //set proceed flag to false
        }
        */
        
        var submit_btn  = $(this).find("input[type=submit]"); //form submit button  
        
        //if everything looks good, proceed with jQuery Ajax
        if(proceed){
            submit_btn.val("Enregistrement...").prop( "disabled", true); //disable submit button
            var form_data = new FormData(this); //Creates new FormData object
            var post_url = $(this).attr("action"); //get action URL of form
            var id_package = $("#id_package_p").val();
            
            //jQuery Ajax to Post form data
$.ajax({
    url : post_url,
    type: "POST",
    data : form_data,
    contentType: false,
    cache: false,
    processData:false,
    xhr: function(){
        //upload Progress
        var xhr = $.ajaxSettings.xhr();
        if (xhr.upload) {
            xhr.upload.addEventListener('progress', function(event) {
                var percent = 0;
                var position = event.loaded || event.position;
                var total = event.total;
                if (event.lengthComputable) {
                    percent = Math.ceil(position / total * 100);
                }
                //show progressbar
                $("#progress-wrp").css('display','block');
                //update progressbar
                $(progress_bar_id +" .progress-bar").css("width", + percent +"%");
                $(progress_bar_id + " .status").text(percent +"%");
            }, true);
        }
        return xhr;
    },
    mimeType:"multipart/form-data"
}).done(function(res){ //
    $(my_form_id)[0].reset(); //reset form
    $('#new-image').attr('src', base_url+'assets/images/holder.jpg');
    $(".article_"+id_package).html(res); //output response from server
    submit_btn.val("Enregistrer").prop( "disabled", false); //enable submit button once ajax is done
    $("#progress-wrp").css('display','none');
});
            
        }
    }
    $(error).each(function(i){ //output any error to output element
        $(result_output).append('<div class="error">'+error[i]+"</div>");
    });
        
});


function charger_modif_produit(id_package)
{
    $.ajax({
    url:base_url+'article/ajax_modal_modif', 
    method:'POST', 
    data:{id_package:id_package}, 
    success:function(result){
        $("#place_modal_modif").html(result);
        }
    });
}
function charger_modal_image(id_package)
{
    $.ajax({
    url:base_url+'article/ajax_modal_image', 
    method:'POST', 
    data:{id_package:id_package}, 
    success:function(result){
        $("#place_modal_image").html(result);
        }
    });
}
function charger_image(id_package)
{
    $.ajax({
    url:base_url+'article/ajax_image', 
    method:'POST', 
    data:{id_package:id_package}, 
    success:function(result){
        $("#article_"+id_package).html(result);
        }
    });
}

function supprimer_image_produit(id_produit,id_package)
{
    if (confirm('Supprimer cette image ?')) {
        $.ajax({
        url:base_url+'produit/delete_image', 
        method:'POST', 
        data:{id_produit:id_produit,id_package:id_package}, 
        success:function(result){
            $(".img_"+id_produit).fadeOut("slow");
            }
        });
    }
}
var ajouterstock = function(nombre_ajout, id_package){
    
    if (nombre_ajout > 0) {
        $.ajax({
                url:base_url+'package/ajouterstock', 
                method:'POST', 
                data:{id_package:id_package,nombre_ajout:nombre_ajout}, 
                success:function(result){
                    $("#place_stock"+id_package).html(result);
                        } 
                    });
    }
}


var ouvert = function(id_package){
    var est_ouvert_p = 1;
    if ($("#ouvert_"+id_package).is(':checked')) {
        est_ouvert_p = 0;
    }
    $.ajax({
            url:base_url+'scolarite/gestion_ue/ouvert', 
            method:'POST', 
            data:{id_package:id_package,est_ouvert_p:est_ouvert_p}, 
            success:function(result){
                console.log(result);
                    } 
                });
}